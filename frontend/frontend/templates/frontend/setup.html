{% extends "base.html" %}
{% load i18n %}_

{% block content %}
<div id="loader-bg"><div id="loader"></div></div>
<div class="page-header">
    <!--h1 style="display: inline">Feed setup:</h1-->
    <h2 style="display: inline" id="setup-tool-string">
        {% trans 'setup.you_are_creating_feed_with' %} <br/> 
        <button id="st-title" class="btn btn-large has-tooltip" title="{% trans 'setup.help' %}"
            data-trigger="hover focus manual" data-animation="true">{% trans 'setup.title' %}</button>
        <a href="javascript::void(0)"><i id="st-title-edit" class="icon-edit"></i></a>
        <button id="st-link" class="btn btn-large">{% trans 'setup.link' %}</button>
        <a href="javascript::void(0)"><i id="st-link-edit" class="icon-edit"></i></a>
        <button id="st-description" class="btn btn-large">{% trans 'setup.description' %}</button> <a href="javascript::void(0)"><i id="st-description-edit" class="icon-edit"></i></a>
        <button id="st-image" class="btn btn-large">{% trans 'setup.image' %}</button>
        <a href="javascript::void(0)"><i id="st-image-edit" class="icon-edit"></i></a>
        <button id="add-field" class="btn" onclick="$('#field-modal').modal()"><i class="icon-plus"></i></button>
        <button id="create" class="btn btn-large btn-primary disabled" style="padding-right: 13px; float:right" data-page-url="{{ page_url }}" data-feed-page-url="{{ feed_page_url }}">{% trans 'setup.create' %} <i class="icon-arrow-right icon-white" style="margin-top: 3px"></i></button>
    </h2>
</div>


<iframe src="{{ external_page_url }}" frameborder="0" style="width:100%;/*for footer*/; border:solid">

</iframe>
    <script type="text/javascript">
        // Based on: http://www.quirksmode.org/js/findpos.html
        var getCumulativeOffset = function (obj) {
            var left, top;
            left = top = 0;
            if (obj.offsetParent) {
                do {
                    left += obj.offsetLeft;
                    top += obj.offsetTop;
                } while (obj = obj.offsetParent);
            }
            return {
                x: left,
                y: top
            };
        };

        var iframe_element = null;

        function update_iframe_heignt()
        {
            var y_offset = getCumulativeOffset(iframe_element).y,
                footer_height = $('#footer').height();
            var height = $(window).height()-y_offset-footer_height;
            if (height < 100)
            {
                iframe_element.style.height = (iframe_element.contentWindow.document.body.offsetHeight) + 'px';
            }
            else
                iframe_element.style.height = height + 'px';
            console.log(iframe_element.style.height);
        }

        $(window).resize(function () {
            if (iframe_element) //iframe is loaded
            {
                update_iframe_heignt();
            }
        });

        $('iframe').load(function() {
            iframe_element = this;
            update_iframe_heignt();
        });
    </script>
<div class="modal hide fade" id="field-modal" style="width:252px;margin-left:-126px">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3>Edit field</h3>
	</div>
	<div class="modal-body">
		<form>
            <fieldset>
            <label>Name</label>
            <input type="text" id="field-name">
            <label class="checkbox">
                <input type="checkbox" id="field-required"> Required
            </label>
            </fieldset>
            <fieldset>
            <legend>Content type</legend>
            <label class="radio">
                <input type="radio" name="fieldContentType" value="1" checked> Text
            </label>
            <label class="radio">
                <input type="radio" name="fieldContentType" value="2"> HTML
            </label>
            <label class="radio">
                <input type="radio" name="fieldContentType" value="3"> Link
            </label>
            <label class="radio">
                <input type="radio" name="fieldContentType" value="4"> Image
            </label>
            </fieldset>
        </form>	
	</div>
	<div class="modal-footer">
		<a href="javascript:void(0)" onclick="$('#field-modal').modal('hide')" class="btn">Close</a>
		<a href="#" class="btn btn-primary">Save changes</a>
	</div>
</div>
{% endblock %}
